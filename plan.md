# Visual regression and integration testing on JS

Доклад: 35 минут
Вопросы: 10 минут

## План презентации

Доклад в виде связанной истории развития инструменов с поинтами от возникновения проблемы к решению и короткими примерами из жизни.

- Вводная часть
  - про команду
  - про разрабатываемые инструменты тестирования (gemini, hermione)
  - про тестирование фронтенда в поисковых сервисах Яндекса (к чему стремимся)

- Модульное регрессионное тестирование вёрстки
  - история создания gemini
    - проблематика на примере общих библиотек Лего
      - сложность поддержки вёрстки во всём многообразии браузеров
      - лаконичные тесты
    - поиск инструментов тестирования, сравнение инструментов
    - реализация
      - как работает
      - пример теста (тестирование элемента в нескольких состояниях)
  - проблемы разработки и внедрения (воспроизводимость, исключение влияния проблем инфраструктуры)
    - калибровка, примеры, как снимаются скриншоты в разных браузерах, на различных платформах
    - мигающая каретка (вопрос, работа с аудиторией)
      - решение на стороне браузеров (Linux, IE, Android)
      - вырезание каретки наезжающей на символы
    - исчезающий scroll (выключаем или ждём)
    - как и зачем появился `retry`
    - таймауты /разнести на другие вопросы/ (настраиваются для разных условий окружения)
    - AA и `tolerance` при сравнении изображений
    - для чего и как использовать `sets` /можно убрать/
    - скорость
      - параллельность: `suitesPerSession` + `sessionsPerBrowser`
      - хранение изображений, оптимизация изображений
    - особенности эксплуатации браузеров
      - нет решения из коробки (существующие провайдеры не предоставляют нормально настроенные браузеры)
      - IE
        - потеря фокуса
        - (FIX'ы в IEDriver)
        - `'ie.enableFullPageScreenshot': false` в капабилити
      - Opera 12.16
        - форк OperaDriver с патчем про видимость элемента
      - Android
        - работа эмуляторов только на железе
        - стабильность
        - изменение высоты экрана из-за исчезающей адресной панели
    - как и зачем появился `skip`
  - подход к написанию тестов
    - (выжимка из Субботника)
    - best practices
    - застабленные данные (пример со временем)
  - helpers
    - плагины позволяют автоматизировать действия (пример с поднятием сервера разработки и selenium перед запуском тестов)
    - gemini-coverage
    - gemini-gui
  - профит в Лего

- Миграция с Java-тестов на JS
  - проблематика
    - цель: ежедневные релизы
    - скорость полного регресса Java-тестами
    - отставания кодовой базы тестов от кодовой базы сервиса
  - необходимость в инструменте, который позволяет выполнять классические selenium-тесты
    - требования
    - выбор инструмента
    - hermione — обёртка над webdriver.io + mocha
      - отличительные особенности от webdriver.io
        - параллельность (по файлам)
        - возможности как из gemini
          - конфигурация
          - `retry`
          - `skip.in()`
          - плагины
          - ...
      - пример теста
  - подходы к написанию тестов
    - про тестовые сценарии, как действия пользователя в тестовом сценарии мапятся на тест
    - best practices
  - схема запуска тестов
    - локальная, на уделенном хосте, автосборка (+про отчеты)
    - пример схемы запуска тестов, подобной схеме в Яндексе (Selenium Grid)
      - (ssh-tunneler, ssh-tun, gemini-tunnel, hermione-tunnel)
    - масштабируемость
  - мониторинг инфраструктуры
    - про стабильность
      - про faildump (gemini-faildump, hermione-faildump)
    - про скорость

- Резюме

## Предполагаемые вопросы

- Конкуренты
  - Gemini
  - Hermione
- Особенности предварительной конфигурации браузеров
- Причины отказа от Java-тестов
- iOS
- Где посмотреть на пример конфигурации
- Selenium Grid, кол-во браузеров, кол-во тестов
